!function(a,b){a.ytp=a.ytp||function(){var c,d,e,f,g,h="0.0.2",i=[],j=!1,k=[],l=[],m=!1;return{isApiReady:function(){return m},setVideoOptions:function(a){e=a},setId:function(a){c=a},init:function(){console.log("init player"),ytp.getLocation(),d=ytp.makeSessionId(),a.onYouTubeIframeAPIReady=function(){return function(){return m=!0,ytp.initializeVideo()}}(this);var b=document.createElement("script");b.src="https://www.youtube.com/iframe_api";var c=document.getElementsByTagName("script")[0];return c.parentNode.insertBefore(b,c),this},initializeVideo:function(){return this.player=new YT.Player(c,{width:e.width,height:e.height,videoId:e.videoId,playerVars:e.playerVars,events:{onReady:e.onReady,onStateChange:function(a){ytp.onPlayerStateChange(a)},onPlaybackQualityChange:e.onPlaybackQualityChange,onPlaybackRateChange:e.onPlaybackRateChange,onApiChange:e.onApiChange,onError:e.onError}}),console.log("player loaded"),this},onPlayerStateChange:function(a){switch(f=a.data,e.onStateChange(a),a.data){case 0:"function"==typeof e.onEnd?e.onEnd(a):void 0;break;case 1:"function"==typeof e.onPlay?e.onPlay(a):void 0,j||ytp.collectStats(),ytp.showSlides();break;case 2:"function"==typeof e.onPause?e.onPause(a):void 0,ytp.sendStats();break;case 3:"function"==typeof e.onBuffer?e.onBuffer(a):void 0}},play:function(){return this.player.playVideo(),this},pause:function(){return this.player.pauseVideo(),this},seekTo:function(a){return this.player.seekTo(a),this},volume:function(a){return this.player.setVolume(a),this},mute:function(){return this.player.mute(),this},getPlayer:function(){return this.player},version:function(){return h},addEventListener:function(a,b){return this.player.addEventListener(a,b),this},removeEventListener:function(a,b){return this.player.removeEventListener(a,b),this},collectStats:function(){var b=0,c=0;j=!0;var d=this;a.setInterval(function(){1==f&&(b=d.player.getCurrentTime(),c=parseInt(b.toFixed()),k.push(c))},1e3)},buildIntervals:function(){l=[],k=k.sort(function(a,b){return a-b});for(var a,b=k[0],c=0;c<k.length;c++)k[c-1]&&k[c]-k[c-1]>1&&(a=k[c-1],l.push({time_from:b,time_to:a}),b=k[c]);l.push({time_from:b,time_to:k[k.length-1]})},showSlides:function(){var b,c=[];e.slides&&e.slides.forEach(function(d,f){var g=d.from.split(":"),h=d.to.split(":");i.push({isVisible:!1,from:60*+g[0]*60+60*+g[1]+ +g[2],to:60*+h[0]*60+60*+h[1]+ +h[2],content:d.content});var j=this;c[f]=a.setInterval(function(){b=j.player.getCurrentTime(),b>=i[f].from&&b<=i[f].to?i[f].isVisible||(e.playerSidebar.html(i[f].content),e.playerSidebar.removeClass("zoomOutUp").addClass("lightSpeedIn"),i[f].isVisible=!0):i[f].isVisible&&(e.playerSidebar.removeClass("lightSpeedIn").addClass("zoomOutUp"),i[f].isVisible=!1)},1e3)})},makeSessionId:function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},getLocation:function(){b.get("http://ipinfo.io",function(a){g=a&&a.country,console.log(g)},"jsonp").error(function(){g="Unknown"})},beforeUnload:function(){var a=this.player.getCurrentTime();this.sendStats(a)},sendStats:function(){var c="http://nodejs-ytapi.rhcloud.com/",f=navigator.userAgent,h=navigator.appName;ytp.buildIntervals(),-1!=f.indexOf("Opera")?h="Opera":-1!=f.indexOf("MSIE")?h="IE":-1!=f.indexOf("Chrome")?h="Chrome":-1!=f.indexOf("Safari")?h="Safari":-1!=f.indexOf("Firefox")&&(h="Firefox");var i={intervals:l,sessionId:d,videoId:e.videoId,videoLength:this.player.getDuration().toFixed(),browserName:h||"Unknown",location:g,ref:a.location.href};b.ajax({type:"POST",url:c,data:i,success:function(){console.log(" DATA "+JSON.stringify(i,null,2)+" SENT!")},error:function(){console.log("ERROR SENDING DATA!")}})},YTPlayer:function(){var b=a.YTPlayerSettings||{};return b.id="YTPlayerContainer",b.width=b.width||640,b.height=b.height||480,b.playerSidebar=b.sidebar&&b.sidebar.css({height:b.height,width:b.width}),b.videoId=b.videoId||"OPf0YbXqDm0",b.playerVars=b.playerVars||{},b.slides=b.slides|{},b.onStateChange=b.onStateChange||function(){},b.onReady=b.onReady||function(){},ytp.setVideoOptions(b),ytp.setId(b.id),ytp.isApiReady()?ytp.initializeVideo():ytp.init()}}}()}(window,window.jQuery);